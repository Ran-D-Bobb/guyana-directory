# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

A WhatsApp-first Progressive Web App for discovering local businesses in Guyana. Every business listing features a prominent "Contact via WhatsApp" button as the primary user interaction method.

**Tech Stack:**
- Next.js 15 (App Router)
- Supabase (PostgreSQL with local CLI for development)
- shadcn/ui components
- Tailwind CSS v4
- TypeScript

## Development Commands

### Initial Setup
```bash
# Create Next.js project
npx create-next-app@latest . --typescript --tailwind --app

# Install Supabase CLI
npm install -g supabase

# Initialize local Supabase (requires Docker)
supabase init
supabase start

# Install shadcn/ui
npx shadcn-ui@latest init
```

### Development
```bash
# Run development server
npm run dev

# Run Supabase locally
supabase start

#update database schema
supabase migration up

# Stop Supabase
supabase stop

# Reset database (careful: deletes all data)
supabase db reset

# Generate TypeScript types from database
supabase gen types typescript --local > types/supabase.ts

# Kill process by port (Windows)
# Step 1: Find process ID on port
netstat -ano | findstr :PORT_NUMBER
# Step 2: Kill the process (use PID from previous command)
taskkill //PID <PID_NUMBER> //F
# Example: Kill all dev servers on ports 3000-3002
taskkill //PID <PID1> //F && taskkill //PID <PID2> //F
```

### Database Migrations
```bash
# Create new migration
supabase migration new <migration_name>

# Apply migrations
supabase db reset
```
### Tracker
read tracker.md before implementing features
update tracker.md when features/tasks are implemented

### Testing & Build
```bash
# Build for production
npm run build

# Run production build locally
npm start

# Lighthouse PWA audit (target: >90)
npm run lighthouse
```

### Deployment
```bash
# Deploy to Vercel
vercel deploy

# Link Supabase project to production
supabase link --project-ref <project-ref>

# Push database to production
supabase db push
```

## Architecture

### Core Database Schema

**profiles** - User accounts (linked to Supabase Auth)
- Stores name, email, photo, phone from Google OAuth

**categories** - Business categories
- name, slug, icon (Lucide React icons), description
- One-to-many with businesses

**regions** - Geographic locations
- name, slug, type (city/town/village/region)
- One-to-many with businesses

**businesses** - Core listings
- Basic: name, slug, description
- Contact: phone, whatsapp_number (required), email, website, address
- Relationships: category_id, region_id
- Status: is_verified, is_featured
- Stats: rating (calculated), review_count, whatsapp_clicks, view_count
- hours: JSON field with structured business hours

**business_photos** - Photo storage
- business_id, image_url, display_order, is_primary
- Max 3 photos for free tier businesses

**reviews** - User reviews
- business_id, user_id, rating (1-5), comment
- Unique constraint: one review per user per business
- Triggers update business.rating and business.review_count on insert/update/delete

**whatsapp_clicks** - Click analytics
- business_id, clicked_at, device_type, user_agent
- Used for business dashboard analytics

### Key Application Patterns

**URL Structure:**
- Home: `/`
- Category: `/businesses/category/[slug]`
- Business Detail: `/businesses/[slug]`
- Search: `/search?q=<query>`
- Dashboard: `/dashboard/my-business`
- Admin: `/admin`

**WhatsApp Integration:**
- Mobile: `https://wa.me/<number>?text=<encoded_message>`
- Desktop: `https://web.whatsapp.com/send?phone=<number>&text=<encoded_message>`
- Message template: "Hi! I found you on Guyana Directory and I'm interested in [business name]"
- Track click before opening WhatsApp (insert into whatsapp_clicks, increment business.whatsapp_clicks)

**Authentication Flow:**
- Google OAuth only (via Supabase Auth)
- On sign-in, create/update profile in profiles table
- Use Supabase RLS policies to protect user data
- Admin access: Check user.email against admin list in environment variables

**PWA Configuration:**
- manifest.ts in app directory defines app metadata
- Service worker auto-generated by Next.js
- Icons: 192x192, 384x384, 512x512 PNG files in /public
- Target Lighthouse PWA score: >90


### Critical Features



**Search Implementation:**
- Search across: business.name, business.description, categories.name
- Use PostgreSQL full-text search (to_tsvector, to_tsquery)
- Apply same filters/sorting as category pages

**Photo Upload:**
- Use Supabase Storage for image hosting
- Bucket: 'business-photos'
- Image optimization: Next.js Image component with appropriate sizes
- Lazy loading: load images as user scrolls

## Development Practices

**Component Organization:**
- Use shadcn/ui components in /components/ui
- Business logic components in /components/business
- Admin components in /components/admin
- Shared layout components in /components/layout

**Database Access:**
- Use Supabase client-side SDK for client components
- Use Supabase server-side SDK for server components and API routes
- Always use Row Level Security (RLS) policies
- Never expose service_role key to client

**Type Safety:**
- Generate TypeScript types from Supabase schema
- Use proper types for all database operations
- Define Zod schemas for form validation

**Performance:**
- Use Next.js Image for all images
- Implement dynamic imports for heavy components
- Use React Suspense for async components
- Cache static data (categories, regions) with SWR or React Query

**Mobile-First Design:**
- Design for 375px width first (iPhone SE)
- Bottom navigation on mobile, top navigation on desktop
- Touch targets minimum 44x44px

## MVP Scope Boundaries

**IN SCOPE:**
- Business directory with categories
- WhatsApp contact as primary CTA
- Google OAuth authentication
- Review system (5-star)
- Basic business owner dashboard (stats, photos, info editing)
- Admin dashboard (add/edit businesses, basic analytics)
- PWA functionality (installable, basic offline support)

**OUT OF SCOPE (Future Phases):**
- Events calendar
- Marketplace listings
- Tourism guides
- In-app messaging
- Payment processing
- Email notifications
- Maps integration
- Review responses from business owners
- Advanced analytics
- Multi-language support








